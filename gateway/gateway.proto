syntax = "proto3";

package gateway;

option go_package = "github.com/kegazani/metachat-proto/gateway";

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/struct.proto";

service GatewayService {
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);
  rpc GetUser(GetUserRequest) returns (GetUserResponse);
  rpc UpdateUserProfile(UpdateUserProfileRequest) returns (UpdateUserProfileResponse);
  rpc AssignArchetype(AssignArchetypeRequest) returns (AssignArchetypeResponse);
  rpc UpdateArchetype(UpdateArchetypeRequest) returns (UpdateArchetypeResponse);
  rpc UpdateModalities(UpdateModalitiesRequest) returns (UpdateModalitiesResponse);
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse);
  
  rpc CreateDiaryEntry(CreateDiaryEntryRequest) returns (CreateDiaryEntryResponse);
  rpc GetDiaryEntry(GetDiaryEntryRequest) returns (GetDiaryEntryResponse);
  rpc UpdateDiaryEntry(UpdateDiaryEntryRequest) returns (UpdateDiaryEntryResponse);
  rpc DeleteDiaryEntry(DeleteDiaryEntryRequest) returns (google.protobuf.Empty);
  rpc StartDiarySession(StartDiarySessionRequest) returns (StartDiarySessionResponse);
  rpc EndDiarySession(EndDiarySessionRequest) returns (EndDiarySessionResponse);
  rpc GetDiarySession(GetDiarySessionRequest) returns (GetDiarySessionResponse);
  rpc ListDiaryEntries(ListDiaryEntriesRequest) returns (ListDiaryEntriesResponse);
  rpc ListDiarySessions(ListDiarySessionsRequest) returns (ListDiarySessionsResponse);
  rpc GetDiaryEntriesByUser(GetDiaryEntriesByUserRequest) returns (GetDiaryEntriesByUserResponse);
  rpc GetDiarySessionsByUser(GetDiarySessionsByUserRequest) returns (GetDiarySessionsByUserResponse);
  rpc GetDiaryAnalytics(GetDiaryAnalyticsRequest) returns (GetDiaryAnalyticsResponse);
  
  rpc FindSimilarUsers(FindSimilarUsersRequest) returns (FindSimilarUsersResponse);
  rpc CalculateUserSimilarity(CalculateUserSimilarityRequest) returns (CalculateUserSimilarityResponse);
  rpc GetUserMatches(GetUserMatchesRequest) returns (GetUserMatchesResponse);
  rpc GetUserPortrait(GetUserPortraitRequest) returns (GetUserPortraitResponse);
  
  rpc GetContentRecommendations(GetContentRecommendationsRequest) returns (GetContentRecommendationsResponse);
  rpc GetUserRecommendations(GetUserRecommendationsRequest) returns (GetUserRecommendationsResponse);
  rpc GetSimilarContent(GetSimilarContentRequest) returns (GetSimilarContentResponse);
  
  rpc AnalyzeText(AnalyzeTextRequest) returns (AnalyzeTextResponse);
  rpc GetUserMoodAggregation(GetUserMoodAggregationRequest) returns (GetUserMoodAggregationResponse);
}

message CreateUserRequest {
  string username = 1;
  string email = 2;
  string first_name = 3;
  string last_name = 4;
  string date_of_birth = 5;
}

message CreateUserResponse {
  User user = 1;
}

message GetUserRequest {
  string id = 1;
}

message GetUserResponse {
  User user = 1;
}

message UpdateUserProfileRequest {
  string id = 1;
  string first_name = 2;
  string last_name = 3;
  string date_of_birth = 4;
  string avatar = 5;
  string bio = 6;
}

message UpdateUserProfileResponse {
  User user = 1;
}

message AssignArchetypeRequest {
  string id = 1;
  string archetype_id = 2;
  string archetype_name = 3;
  double confidence = 4;
  string description = 5;
}

message AssignArchetypeResponse {
  User user = 1;
}

message UpdateArchetypeRequest {
  string id = 1;
  string archetype_id = 2;
  string archetype_name = 3;
  double confidence = 4;
  string description = 5;
}

message UpdateArchetypeResponse {
  User user = 1;
}

message UpdateModalitiesRequest {
  string id = 1;
  repeated UserModality modalities = 2;
}

message UpdateModalitiesResponse {
  User user = 1;
}

message ListUsersRequest {
  int32 page = 1;
  int32 limit = 2;
  string filter = 3;
}

message ListUsersResponse {
  repeated User users = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
}

message CreateDiaryEntryRequest {
  string user_id = 1;
  string title = 2;
  string content = 3;
  int32 token_count = 4;
  string session_id = 5;
  repeated string tags = 6;
}

message CreateDiaryEntryResponse {
  DiaryEntry entry = 1;
}

message GetDiaryEntryRequest {
  string id = 1;
}

message GetDiaryEntryResponse {
  DiaryEntry entry = 1;
}

message UpdateDiaryEntryRequest {
  string id = 1;
  string title = 2;
  string content = 3;
  int32 token_count = 4;
  repeated string tags = 5;
}

message UpdateDiaryEntryResponse {
  DiaryEntry entry = 1;
}

message DeleteDiaryEntryRequest {
  string id = 1;
}

message StartDiarySessionRequest {
  string user_id = 1;
  string title = 2;
  string description = 3;
}

message StartDiarySessionResponse {
  DiarySession session = 1;
}

message EndDiarySessionRequest {
  string id = 1;
}

message EndDiarySessionResponse {
  DiarySession session = 1;
}

message GetDiarySessionRequest {
  string id = 1;
}

message GetDiarySessionResponse {
  DiarySession session = 1;
}

message ListDiaryEntriesRequest {
  int32 page = 1;
  int32 limit = 2;
  string filter = 3;
}

message ListDiaryEntriesResponse {
  repeated DiaryEntry entries = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
}

message ListDiarySessionsRequest {
  int32 page = 1;
  int32 limit = 2;
  string filter = 3;
}

message ListDiarySessionsResponse {
  repeated DiarySession sessions = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
}

message GetDiaryEntriesByUserRequest {
  string user_id = 1;
  int32 page = 2;
  int32 limit = 3;
}

message GetDiaryEntriesByUserResponse {
  repeated DiaryEntry entries = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
}

message GetDiarySessionsByUserRequest {
  string user_id = 1;
  int32 page = 2;
  int32 limit = 3;
}

message GetDiarySessionsByUserResponse {
  repeated DiarySession sessions = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
}

message GetDiaryAnalyticsRequest {
  google.protobuf.Empty empty = 1;
}

message GetDiaryAnalyticsResponse {
  DiaryAnalytics analytics = 1;
}

message FindSimilarUsersRequest {
  string user_id = 1;
  int32 limit = 2;
}

message FindSimilarUsersResponse {
  repeated UserMatch matches = 1;
}

message CalculateUserSimilarityRequest {
  string user_id1 = 1;
  string user_id2 = 2;
}

message CalculateUserSimilarityResponse {
  double similarity = 1;
}

message GetUserMatchesRequest {
  string user_id = 1;
}

message GetUserMatchesResponse {
  repeated UserMatch matches = 1;
}

message GetUserPortraitRequest {
  string user_id = 1;
}

message GetUserPortraitResponse {
  UserPortrait portrait = 1;
}

message GetContentRecommendationsRequest {
  string user_id = 1;
  int32 limit = 2;
}

message GetContentRecommendationsResponse {
  repeated ContentRecommendation recommendations = 1;
}

message GetUserRecommendationsRequest {
  string user_id = 1;
  int32 limit = 2;
}

message GetUserRecommendationsResponse {
  repeated UserMatch matches = 1;
}

message GetSimilarContentRequest {
  string content_id = 1;
  int32 limit = 2;
}

message GetSimilarContentResponse {
  repeated Content content = 1;
}

message User {
  string id = 1;
  string username = 2;
  string email = 3;
  string first_name = 4;
  string last_name = 5;
  string date_of_birth = 6;
  string avatar = 7;
  string bio = 8;
  Archetype archetype = 9;
  repeated UserModality modalities = 10;
  google.protobuf.Timestamp created_at = 11;
  google.protobuf.Timestamp updated_at = 12;
}

message Archetype {
  string id = 1;
  string name = 2;
  string description = 3;
  double confidence = 4;
  google.protobuf.Timestamp assigned_at = 5;
}

message UserModality {
  string id = 1;
  string name = 2;
  double score = 3;
  string description = 4;
}

message DiaryEntry {
  string id = 1;
  string user_id = 2;
  string title = 3;
  string content = 4;
  int32 token_count = 5;
  string session_id = 6;
  repeated string tags = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
}

message DiarySession {
  string id = 1;
  string user_id = 2;
  string title = 3;
  string description = 4;
  google.protobuf.Timestamp started_at = 5;
  google.protobuf.Timestamp ended_at = 6;
  string status = 7;
  int32 entry_count = 8;
}

message DiaryAnalytics {
  int64 total_entries = 1;
  int64 total_sessions = 2;
  int64 active_users = 3;
  double average_entries_per_session = 4;
  double average_sessions_per_user = 5;
  google.protobuf.Timestamp last_updated = 6;
}

message UserMatch {
  string user_id1 = 1;
  string user_id2 = 2;
  double similarity = 3;
  repeated string common_tags = 4;
  google.protobuf.Timestamp created_at = 5;
}

message UserPortrait {
  string user_id = 1;
  map<string, double> mood_profile = 2;
  map<string, double> personality_traits = 3;
  repeated string interests = 4;
  map<string, google.protobuf.Value> modalities = 5;
  google.protobuf.Timestamp last_updated = 6;
}

message Content {
  string id = 1;
  string title = 2;
  string description = 3;
  string type = 4;
  repeated string tags = 5;
  map<string, google.protobuf.Value> metadata = 6;
  google.protobuf.Timestamp created_at = 7;
}

message ContentRecommendation {
  Content content = 1;
  double score = 2;
  string reason = 3;
}

message AnalyzeTextRequest {
  string text = 1;
}

message AnalyzeTextResponse {
  repeated MoodScore mood_scores = 1;
  string dominant_mood = 2;
  float dominant_score = 3;
}

message MoodScore {
  string mood = 1;
  float score = 2;
}

message GetUserMoodAggregationRequest {
  string user_id = 1;
  string time_range = 2;
}

message GetUserMoodAggregationResponse {
  string user_id = 1;
  string time_range = 2;
  string start_time = 3;
  string end_time = 4;
  int32 entry_count = 5;
  repeated MoodAggregation mood_aggregations = 6;
  repeated DominantMoodCount dominant_mood_counts = 7;
  string overall_dominant_mood = 8;
}

message MoodAggregation {
  string mood = 1;
  float average = 2;
  float max = 3;
  float min = 4;
  int32 count = 5;
}

message DominantMoodCount {
  string mood = 1;
  int32 count = 2;
}

